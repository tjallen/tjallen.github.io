{"version":3,"sources":["nightingalePlayer.js"],"names":["browserCanLoadVideo","isChromium","window","chrome","isFF","sidebar","isOpera","opera","test","navigator","userAgent","isSafari","HTMLElement","isIE","msPointerEnabled","isOldIE","ActiveXObject","isMobile","Android","match","BlackBerry","iOS","Opera","Windows","any","$","css","find","nightingaleYTDeferred","Deferred","onYouTubeIframeAPIReady","resolve","YT","getScript","done","script","textStatus","_disabledOuter","_disabledInner","_message","_modal","on","toggleClass","nightingalePlayer","init","options","s","settings","initSettingsChildren","prop","hasOwnProperty","defaults","$playerElem","length","ytp","Player","playerElem","width","playerWidth","height","playerHeight","videoId","videoKey","playerVars","autoplay","autoPlay","enablejsapi","enableYouTubeApi","controls","enableControls","rel","showRelatedContent","showinfo","showPlayerInfo","modestbranding","enableModestBranding","events","onReady","onPlayerReady","onStateChange","onPlayerStateChange","$playerOverlays","fadeIn","console","error","bindCustomEvents","$d","onFullscreenChange","$playerSeekSlider","onSeekMouseDown","onSeekMouseUp","onSeekMouseMove","$standardPlayerControls","onStandardPlayerControlsClick","$replayVideoBtn","onReplayBtnClick","$volContainer","onVolumeContainerInteract","$volTrack","onVolumeSliderMouseDown","onVolumeSliderMouseMove","onVolumeSliderMouseUp","$muteToggleBtn","onMuteToggleHover","$allControlsWrapper","onControlsBlur","$facebookShareBtn","onFacebookShareClick","$twitterShareBtn","onTwitterShareClick","event","totalDuration","getDuration","_currentVolume","getVolume","$volSlider","playerVolumeLevel","target","setPlaybackQuality","_activeClass","data","PlayerState","PLAYING","onPlayerStatePlaying","$playPauseBtn","addClass","clearTimeout","updateTimer","PAUSED","removeClass","ENDED","onPlayerStateEnded","$fsToggleBtn","_id","this","attr","getPlayerState","pauseVideo","playVideo","isMuted","unMute","mute","requestFullScreen","hasClass","e","thumbDragging","updatePlayedBar","pageX","$playerEndframe","fadeOut","duration","complete","onEndframeFadeOutComplete","stopPropagation","updateVolumeBar","stop","animate","setInterval","currentTime","getCurrentTime","percentage","$playedBar","$endFrameWrapper","is","hide","show","_percentage","calculateSliderPercentage","_seekValue","seekTo","_volumeValue","Math","round","setVolume","sliderTrack","_position","offset","left","isFullscreen","_requestMethod","_element","document","cancelFullScreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen","body","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen","call","wscript","SendKeys","$controlsContainer","colorTheme","primary","secondary","$controlsList","$volSliderThumb"],"mappings":"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","file":"nightingalePlayer.js","sourcesContent":["/***************************************************\r\n  Browser sniffage\r\n\r\n  Since we cannot target browsers for any '360 video enabled' feature,\r\n  and a youtube 360 api is non existent at the moment, user agent sniffing is only answer\r\n  for this case. Below we are looking for Chromium browsers, FF or Opera (360 supported).\r\n\r\n***************************************************/\r\nvar isMobile = {\r\n\r\n    Android: function() {\r\n        return navigator.userAgent.match(/Android/i);\r\n    },\r\n    BlackBerry: function() {\r\n        return navigator.userAgent.match(/BlackBerry/i);\r\n    },\r\n    iOS: function() {\r\n        return navigator.userAgent.match(/iPhone|iPad|iPod/i);\r\n    },\r\n    Opera: function() {\r\n        return navigator.userAgent.match(/Opera Mini/i);\r\n    },\r\n    Windows: function() {\r\n        return navigator.userAgent.match(/IEMobile/i);\r\n    },\r\n    any: function() {\r\n        return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());\r\n    }\r\n};\r\n\r\n// If not mobile\r\nif (!isMobile.any()) {\r\n  // Check for 360 supported browser\r\n  if (browserCanLoadVideo()) {\r\n    // Set player YT Deferred\r\n    var nightingaleYTDeferred = $.Deferred();\r\n    window.onYouTubeIframeAPIReady = function() {\r\n      nightingaleYTDeferred.resolve(window.YT);\r\n    };\r\n    // YouTube API ajax call\r\n    $.getScript( \"https://www.youtube.com/iframe_api\")\r\n      .done(function(script, textStatus) {\r\n    });\r\n  } else {\r\n    // Set up and display overlay if 360 not supported.\r\n    var _disabledOuter = $('#disabled-overlay'),\r\n        _disabledInner =   $('#disabled-overlay__inner'),\r\n        _message = _disabledInner.find('#disabled-overlay__inner__message'),\r\n        _modal = $('#disabled-overlay__modal');\r\n\r\n    // Show the overlay\r\n    _disabledOuter.css('display', 'table');\r\n    // Bind events\r\n    _disabledInner.find('a').on('click', function(){\r\n      _modal.toggleClass('active');\r\n      _message.toggleClass('active');\r\n      return false;\r\n    });\r\n    _modal.find('span').on('click', function(){\r\n      _modal.toggleClass('active');\r\n      _message.toggleClass('active');\r\n    });\r\n  }\r\n}else{\r\n  // If mobile, display the mobile overlay\r\n  $('#mobile-overlay').css('display', 'table');\r\n  // Set overflow-y to visible for mobile scrolling\r\n  $('html').css('overflow', 'visible').find('body').css('overflow', 'visible');\r\n}\r\n\r\nfunction browserCanLoadVideo() {\r\n  // chrome / opera\r\n  var isChromium = !!window.chrome;\r\n  // ff *\r\n  var isFF = !!window.sidebar;\r\n  // opera *\r\n  var isOpera = !!window.opera || /opera|opr/i.test(navigator.userAgent);\r\n  // sfari *\r\n  var isSafari = /constructor/i.test(window.HTMLElement);\r\n  // ie >= 10\r\n  var isIE = window.navigator.msPointerEnabled;\r\n  // ie 6-10\r\n  var isOldIE = !!window.ActiveXObject;\r\n\r\n  if ((isChromium) || (isFF) || (isOpera)) {\r\n    return true;\r\n  }\r\n  if (isSafari || isIE || isOldIE) {\r\n    return false;\r\n  }\r\n  return false;\r\n}\r\n\r\n// nightingalePlayer constructor\r\nvar nightingalePlayer = (function() {\r\n  // Player vars\r\n  var $d = $(document),\r\n      updateTimer,\r\n      totalDuration,\r\n      playerVolumeLevel,\r\n      ytp,\r\n      s,\r\n      // Player settings\r\n      settings = {\r\n        // Define player elements\r\n        $playerOverlays: $('.player-overlay'),\r\n        $endFrameWrapper: $('#endframe-overlay-wrapper'),\r\n        $playerEndframe: $('#endframe-overlay'),\r\n        $allControlsWrapper: $('.controls'),\r\n        $standardPlayerControls: $('.controls__standard'),\r\n        $controlsContainer: $('#controls__expanding_centre'),\r\n        $playPauseBtn: $('#controls__standard--play-pause'),\r\n        $muteToggleBtn: $('#controls__standard--toggle-mute'),\r\n        $fsToggleBtn: $('#controls__standard--fs'),\r\n        $facebookShareBtn: $('.facebook-share'),\r\n        $twitterShareBtn: $('.twitter-share'),\r\n        $playerSeekSlider: $('.seekslider'),\r\n        $playedBar: $('.seekslider__played'),\r\n        thumbDragging: false,\r\n        $volContainer: $('.volume'),\r\n        // Define player colour theme;\r\n        colorTheme:{\r\n          primary: '#ffffff',\r\n          secondary: '#f44c02'\r\n        },\r\n        // Overridable default settings\r\n        defaults: {\r\n          videoKey: 'Mnf15KwPV-Q'\r\n        },\r\n        // YouTube Api params\r\n        playerElem: 'nightingalePlayer',\r\n        playerWidth: '100%',\r\n        playerHeight: '100%',\r\n        autoPlay: 1,\r\n        enableYouTubeApi: 1,\r\n        enableControls: 0,\r\n        showPlayerInfo: 0,\r\n        showRelatedContent: 0,\r\n        enableModestBranding: 1,\r\n\r\n        initSettingsChildren: function() {\r\n          // Settings that need sibling reference\r\n          this.$playerElem =  $('#'+this.playerElem);\r\n          this.$replayVideoBtn = this.$playerEndframe.find('button');\r\n          this.$controlsList = this.$controlsContainer.find('ul');\r\n          this.$volTrack = this.$volContainer.find('.volume__track');\r\n          this.$volSlider = this.$volContainer.find('.volume__track__slider');\r\n          this.$volSliderThumb = this.$volContainer.find('.volume__track__thumb');\r\n\r\n          delete this.initSettingsChildren;\r\n          return this;\r\n        }\r\n    };\r\n\r\n    function init(options){\r\n\r\n      s = settings;\r\n      s.initSettingsChildren();\r\n\r\n      // If set, apply override options to settings\r\n      if(options){\r\n        for(var prop in options){\r\n          if(options.hasOwnProperty(prop)){\r\n              s.defaults[prop] = options[prop];\r\n          }\r\n        }\r\n      }\r\n\r\n      // Check for target div\r\n      if(s.$playerElem.length){\r\n\r\n        // New up YouTube player with player settings\r\n        ytp = new YT.Player(s.playerElem, {\r\n            width: s.playerWidth,\r\n            height: s.playerHeight,\r\n            // videoId: (browserCanLoadVideo()) ? s.defaults.videoKey : s.defaults.disabledBrowsersKey,\r\n            videoId: s.defaults.videoKey,\r\n            playerVars: {\r\n            autoplay: s.autoPlay,\r\n            enablejsapi: s.enableYouTubeApi,\r\n            controls: s.enableControls,\r\n            rel: s.showRelatedContent,\r\n            showinfo: s.showPlayerInfo,\r\n            modestbranding: s.enableModestBranding\r\n          },\r\n          events: {\r\n            'onReady': onPlayerReady,\r\n            'onStateChange': onPlayerStateChange\r\n          }\r\n        });\r\n\r\n        // Fade up the player overlays\r\n        s.$playerOverlays.fadeIn();\r\n\r\n      }else{\r\n        // Throw an error if no target div found.\r\n        console.error('nightingalePlayer Error: Cannot initialise, no target div found. Please add a div with id \"nightingalePlayer\" to the page.');\r\n      }\r\n    }\r\n\r\n    // Bind custom player events\r\n    function bindCustomEvents(){\r\n      // DOCUMENT on FULLSCREEN\r\n      $d.on('webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange', onFullscreenChange);\r\n      // SEEK slider on MOUSE DOWN / UP / CHANGE\r\n      s.$playerSeekSlider.on('mousedown', onSeekMouseDown)\r\n      .on('mouseup', onSeekMouseUp)\r\n      .on('mousemove', onSeekMouseMove);\r\n      // STANDARD player control on CLICK\r\n      s.$standardPlayerControls.on('click', onStandardPlayerControlsClick);\r\n      // REPLAY video button on CLICK\r\n      s.$replayVideoBtn.on('click', onReplayBtnClick);\r\n      // VOLUME container on CLICK\r\n      s.$volContainer.on('click', onVolumeContainerInteract);\r\n      // VOLUME slider on INPUT CHANGE\r\n      s.$volTrack.on('mousedown', onVolumeSliderMouseDown)\r\n      .on('mousemove', onVolumeSliderMouseMove)\r\n      .on('mouseup', onVolumeSliderMouseUp);\r\n      // MUTE button on MOUSEOVER\r\n      s.$muteToggleBtn.on('mouseover', onMuteToggleHover);\r\n      // MUTE button on MOUSELEAVE\r\n      s.$allControlsWrapper.on('mouseleave', onControlsBlur);\r\n      // FACEBOOK share button on CLICK\r\n      s.$facebookShareBtn.on('click', onFacebookShareClick);\r\n      // TWITTER share button on CLICK\r\n      s.$twitterShareBtn.on('click', onTwitterShareClick);\r\n    }\r\n\r\n    /*******************************************************************************\r\n    * Youtube Event Handlers\r\n    ******************************************************************************/\r\n\r\n    // YouTube player ready\r\n    function onPlayerReady(event){\r\n\r\n      // Set current video duration\r\n      totalDuration = ytp.getDuration();\r\n      // Get the current volume\r\n      var _currentVolume = ytp.getVolume();\r\n      // Set up volume slider\r\n      s.$volSlider.css('width', _currentVolume+'%');\r\n      // Update the current volume level in the volume slider\r\n      playerVolumeLevel = s.$volSlider.css('width');\r\n      // Set YouTube player to default quality state for appropriate playback quality\r\n      event.target.setPlaybackQuality('default');\r\n      // Bind custom events\r\n      bindCustomEvents();\r\n    }\r\n\r\n    function onPlayerStateChange (event){\r\n\r\n      var _activeClass = 'active';\r\n\r\n      // YouTube Player States\r\n      if (event.data == YT.PlayerState.PLAYING) {\r\n\r\n        onPlayerStatePlaying();\r\n        // Toggle play / pause\r\n        s.$playPauseBtn.addClass(_activeClass);\r\n\r\n      } else {\r\n        // Stops the seek bar if not playing\r\n        clearTimeout(updateTimer);\r\n      }\r\n      if(event.data == YT.PlayerState.PAUSED){\r\n        // Toggle play / pause\r\n        s.$playPauseBtn.removeClass(_activeClass);\r\n      }\r\n      if(event.data == YT.PlayerState.ENDED){\r\n        onPlayerStateEnded();\r\n        // Toggle play / pause\r\n        s.$playPauseBtn.removeClass(_activeClass);\r\n      }\r\n    }\r\n\r\n    /*******************************************************************************\r\n    * nightingalePlayer Event Handlers\r\n    ******************************************************************************/\r\n\r\n    // On FULLSCREEN change\r\n    function onFullscreenChange(){\r\n      s.$fsToggleBtn.toggleClass('active');\r\n    }\r\n\r\n    // On STANDARD player control CLICK\r\n    function onStandardPlayerControlsClick(){\r\n\r\n      var _id = $(this).attr('id');\r\n\r\n      switch(_id){\r\n\r\n        case 'controls__standard--play-pause':\r\n          if (ytp.getPlayerState() == YT.PlayerState.PLAYING) {\r\n              ytp.pauseVideo();\r\n          } else {\r\n              ytp.playVideo();\r\n          }\r\n        break;\r\n\r\n        case 'controls__standard--toggle-mute':\r\n          if (!ytp.isMuted()) {\r\n              ytp.mute();\r\n              s.$volSlider.css('width', '0%');\r\n          } else {\r\n              ytp.unMute();\r\n              s.$volSlider.css('width', playerVolumeLevel);\r\n          }\r\n          $(this).toggleClass('active');\r\n        break;\r\n\r\n        case 'controls__standard--fs':\r\n          requestFullScreen($(this).hasClass('active'));\r\n        break;\r\n      }\r\n    }\r\n\r\n    // On FACEBOOK button CLICK\r\n    function onFacebookShareClick(){\r\n      // Facebook sharing functionality\r\n    }\r\n\r\n    function onTwitterShareClick(){\r\n      // Twitter sharing functionality\r\n    }\r\n\r\n    // On SEEK slider MOUSE DOWN\r\n    function onSeekMouseDown(e) {\r\n      // pause video and listen for input events (value changes) from dragging\r\n      ytp.pauseVideo();\r\n      s.thumbDragging = true;\r\n      updatePlayedBar(e.pageX);\r\n    }\r\n\r\n    // On SEEK slider MOUSE UP\r\n    function onSeekMouseUp(e) {\r\n      if(s.thumbDragging){\r\n        s.thumbDragging = false;\r\n        updatePlayedBar(e.pageX);\r\n        ytp.playVideo();\r\n      }\r\n    }\r\n\r\n    // On SEEK mouse MOVE\r\n    function onSeekMouseMove(e){\r\n      if(s.thumbDragging) {\r\n        clearTimeout(updateTimer);\r\n        updatePlayedBar(e.pageX);\r\n      }\r\n    }\r\n\r\n    // On REPLAY button mouse CLICK\r\n    function onReplayBtnClick(){\r\n      s.$playerEndframe.fadeOut({duration : 800, complete: onEndframeFadeOutComplete});\r\n    }\r\n\r\n    // On POSTER fade out COMPLETE\r\n    function onEndframeFadeOutComplete(){\r\n      ytp.playVideo();\r\n    }\r\n\r\n    // On VOLUME container CLICK\r\n    function onVolumeContainerInteract(e) {\r\n      // Prevent accidental closes while dragging volume slider\r\n      e.stopPropagation();\r\n    }\r\n    // get value of volume slider and translate into ytp volume\r\n    function onVolumeSliderMouseDown(e) {\r\n\r\n      s.thumbDragging = true;\r\n      updateVolumeBar(e.pageX);\r\n\r\n    }\r\n\r\n    function onVolumeSliderMouseMove(e){\r\n      if(s.thumbDragging) {\r\n        updateVolumeBar(e.pageX);\r\n      }\r\n    }\r\n\r\n    function onVolumeSliderMouseUp(e){\r\n      if(s.thumbDragging){\r\n        s.thumbDragging = false;\r\n        updateVolumeBar(e.pageX);\r\n      }\r\n    }\r\n\r\n    function onMuteToggleHover() {\r\n      s.$volContainer.addClass('active');\r\n      s.$volContainer.stop().animate({\r\n        width: '120px'\r\n      }, 150, 'easeInOutQuad')\r\n      .css('overflow', 'visible');\r\n    }\r\n\r\n    function onControlsBlur() {\r\n      s.$volContainer.stop().animate({\r\n        width: '0'\r\n      }, 200, 'easeInOutQuad', function() {\r\n        s.$volContainer.removeClass('active');\r\n      }).css('overflow', 'visible');\r\n\r\n      if(s.thumbDragging){\r\n        s.thumbDragging = false;\r\n      }\r\n    }\r\n\r\n    /*******************************************************************************\r\n    * player STATES\r\n    ******************************************************************************/\r\n\r\n    function onPlayerStatePlaying(){\r\n\r\n      // Set up interval timer to move silder thumb along the track\r\n      updateTimer = setInterval(function() {\r\n\r\n        var currentTime = ytp.getCurrentTime(),\r\n            percentage = 100 * currentTime / totalDuration;\r\n\r\n        s.$playedBar.css('width', percentage+'%');\r\n\r\n      }, 400);\r\n\r\n      // Hide the endframe if it is visible and the video starts playing\r\n      if (s.$endFrameWrapper.is(':visible')) {\r\n        s.$endFrameWrapper.hide();\r\n      }\r\n    }\r\n\r\n    function onPlayerStateEnded(){\r\n      // show the end frame, hide player behind it.\r\n      s.$endFrameWrapper.show();\r\n      s.$playerEndframe.fadeIn(1000);\r\n\r\n      // Set played bar to end position\r\n      s.$playedBar.css('width', '100%');\r\n    }\r\n\r\n    /*******************************************************************************\r\n    * nightingalePlayer Functions\r\n    ******************************************************************************/\r\n\r\n    // Update played bar width and seek to on mouse move\r\n    function updatePlayedBar(pageX) {\r\n\r\n      // Calulate new slider percentage and volume level\r\n      var _percentage = calculateSliderPercentage(pageX, s.$playerSeekSlider),\r\n      _seekValue = totalDuration * _percentage / 100;\r\n\r\n      // Update played bar\r\n      s.$playedBar.css('width', _percentage+'%');\r\n\r\n      // Seek to new current position\r\n      ytp.seekTo(_seekValue);\r\n    }\r\n\r\n    // Update volume bar on mouse move\r\n    function updateVolumeBar(pageX){\r\n\r\n      // Calulate new slider percentage and volume level\r\n      var _percentage = calculateSliderPercentage(pageX, s.$volTrack),\r\n          _volumeValue = Math.round(_percentage);\r\n\r\n      if (_volumeValue !== 0) {\r\n        ytp.unMute();\r\n        ytp.setVolume(_volumeValue);\r\n        s.$muteToggleBtn.addClass('active');\r\n      } else if (_volumeValue === 0) {\r\n        ytp.mute();\r\n        s.$muteToggleBtn.removeClass('active');\r\n      }\r\n\r\n      playerVolumeLevel = ytp.getVolume()+'%';\r\n      s.$volSlider.css('width', _percentage+'%');\r\n    }\r\n\r\n    // Calulate slider percentage\r\n    function calculateSliderPercentage(pageX, sliderTrack){\r\n\r\n      // Get the click position\r\n      var _position = pageX - sliderTrack.offset().left,\r\n          // Calulate the percentage\r\n          _percentage = 100 * _position / sliderTrack.width();\r\n\r\n      // Check within range\r\n      if(_percentage > 100) {\r\n          _percentage = 100;\r\n      }\r\n      if(_percentage < 0) {\r\n          _percentage = 0;\r\n      }\r\n\r\n      return _percentage;\r\n    }\r\n\r\n    // Fullscreen handler\r\n    function requestFullScreen(isFullscreen){\r\n\r\n      var _requestMethod,\r\n          _element;\r\n\r\n      if(!isFullscreen){\r\n        _element = document.body;\r\n        _requestMethod = _element.requestFullScreen || _element.webkitRequestFullScreen || _element.mozRequestFullScreen || _element.msRequestFullscreen;\r\n      } else {\r\n        _element = document;\r\n        _requestMethod = _element.cancelFullScreen || _element.webkitCancelFullScreen || _element.mozCancelFullScreen || _element.msExitFullscreen;\r\n      }\r\n\r\n      if (_requestMethod) {\r\n          _requestMethod.call(_element);\r\n      } else if (typeof window.ActiveXObject !== \"undefined\") {\r\n          var wscript = new ActiveXObject(\"WScript.Shell\");\r\n          if (wscript !== null) {\r\n              wscript.SendKeys(\"{F11}\");\r\n          }\r\n      }\r\n    }\r\n\r\n    // Return public\r\n    return {\r\n      init: init\r\n    };\r\n\r\n})($);\r\n\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJuaWdodGluZ2FsZVBsYXllci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgQnJvd3NlciBzbmlmZmFnZVxyXG5cclxuICBTaW5jZSB3ZSBjYW5ub3QgdGFyZ2V0IGJyb3dzZXJzIGZvciBhbnkgJzM2MCB2aWRlbyBlbmFibGVkJyBmZWF0dXJlLFxyXG4gIGFuZCBhIHlvdXR1YmUgMzYwIGFwaSBpcyBub24gZXhpc3RlbnQgYXQgdGhlIG1vbWVudCwgdXNlciBhZ2VudCBzbmlmZmluZyBpcyBvbmx5IGFuc3dlclxyXG4gIGZvciB0aGlzIGNhc2UuIEJlbG93IHdlIGFyZSBsb29raW5nIGZvciBDaHJvbWl1bSBicm93c2VycywgRkYgb3IgT3BlcmEgKDM2MCBzdXBwb3J0ZWQpLlxyXG5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG52YXIgaXNNb2JpbGUgPSB7XHJcblxyXG4gICAgQW5kcm9pZDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0FuZHJvaWQvaSk7XHJcbiAgICB9LFxyXG4gICAgQmxhY2tCZXJyeTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0JsYWNrQmVycnkvaSk7XHJcbiAgICB9LFxyXG4gICAgaU9TOiBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvaVBob25lfGlQYWR8aVBvZC9pKTtcclxuICAgIH0sXHJcbiAgICBPcGVyYTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL09wZXJhIE1pbmkvaSk7XHJcbiAgICB9LFxyXG4gICAgV2luZG93czogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0lFTW9iaWxlL2kpO1xyXG4gICAgfSxcclxuICAgIGFueTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIChpc01vYmlsZS5BbmRyb2lkKCkgfHwgaXNNb2JpbGUuQmxhY2tCZXJyeSgpIHx8IGlzTW9iaWxlLmlPUygpIHx8IGlzTW9iaWxlLk9wZXJhKCkgfHwgaXNNb2JpbGUuV2luZG93cygpKTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIElmIG5vdCBtb2JpbGVcclxuaWYgKCFpc01vYmlsZS5hbnkoKSkge1xyXG4gIC8vIENoZWNrIGZvciAzNjAgc3VwcG9ydGVkIGJyb3dzZXJcclxuICBpZiAoYnJvd3NlckNhbkxvYWRWaWRlbygpKSB7XHJcbiAgICAvLyBTZXQgcGxheWVyIFlUIERlZmVycmVkXHJcbiAgICB2YXIgbmlnaHRpbmdhbGVZVERlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xyXG4gICAgd2luZG93Lm9uWW91VHViZUlmcmFtZUFQSVJlYWR5ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIG5pZ2h0aW5nYWxlWVREZWZlcnJlZC5yZXNvbHZlKHdpbmRvdy5ZVCk7XHJcbiAgICB9O1xyXG4gICAgLy8gWW91VHViZSBBUEkgYWpheCBjYWxsXHJcbiAgICAkLmdldFNjcmlwdCggXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9pZnJhbWVfYXBpXCIpXHJcbiAgICAgIC5kb25lKGZ1bmN0aW9uKHNjcmlwdCwgdGV4dFN0YXR1cykge1xyXG4gICAgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vIFNldCB1cCBhbmQgZGlzcGxheSBvdmVybGF5IGlmIDM2MCBub3Qgc3VwcG9ydGVkLlxyXG4gICAgdmFyIF9kaXNhYmxlZE91dGVyID0gJCgnI2Rpc2FibGVkLW92ZXJsYXknKSxcclxuICAgICAgICBfZGlzYWJsZWRJbm5lciA9ICAgJCgnI2Rpc2FibGVkLW92ZXJsYXlfX2lubmVyJyksXHJcbiAgICAgICAgX21lc3NhZ2UgPSBfZGlzYWJsZWRJbm5lci5maW5kKCcjZGlzYWJsZWQtb3ZlcmxheV9faW5uZXJfX21lc3NhZ2UnKSxcclxuICAgICAgICBfbW9kYWwgPSAkKCcjZGlzYWJsZWQtb3ZlcmxheV9fbW9kYWwnKTtcclxuXHJcbiAgICAvLyBTaG93IHRoZSBvdmVybGF5XHJcbiAgICBfZGlzYWJsZWRPdXRlci5jc3MoJ2Rpc3BsYXknLCAndGFibGUnKTtcclxuICAgIC8vIEJpbmQgZXZlbnRzXHJcbiAgICBfZGlzYWJsZWRJbm5lci5maW5kKCdhJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgX21vZGFsLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgX21lc3NhZ2UudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9KTtcclxuICAgIF9tb2RhbC5maW5kKCdzcGFuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgX21vZGFsLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgX21lc3NhZ2UudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59ZWxzZXtcclxuICAvLyBJZiBtb2JpbGUsIGRpc3BsYXkgdGhlIG1vYmlsZSBvdmVybGF5XHJcbiAgJCgnI21vYmlsZS1vdmVybGF5JykuY3NzKCdkaXNwbGF5JywgJ3RhYmxlJyk7XHJcbiAgLy8gU2V0IG92ZXJmbG93LXkgdG8gdmlzaWJsZSBmb3IgbW9iaWxlIHNjcm9sbGluZ1xyXG4gICQoJ2h0bWwnKS5jc3MoJ292ZXJmbG93JywgJ3Zpc2libGUnKS5maW5kKCdib2R5JykuY3NzKCdvdmVyZmxvdycsICd2aXNpYmxlJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJyb3dzZXJDYW5Mb2FkVmlkZW8oKSB7XHJcbiAgLy8gY2hyb21lIC8gb3BlcmFcclxuICB2YXIgaXNDaHJvbWl1bSA9ICEhd2luZG93LmNocm9tZTtcclxuICAvLyBmZiAqXHJcbiAgdmFyIGlzRkYgPSAhIXdpbmRvdy5zaWRlYmFyO1xyXG4gIC8vIG9wZXJhICpcclxuICB2YXIgaXNPcGVyYSA9ICEhd2luZG93Lm9wZXJhIHx8IC9vcGVyYXxvcHIvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG4gIC8vIHNmYXJpICpcclxuICB2YXIgaXNTYWZhcmkgPSAvY29uc3RydWN0b3IvaS50ZXN0KHdpbmRvdy5IVE1MRWxlbWVudCk7XHJcbiAgLy8gaWUgPj0gMTBcclxuICB2YXIgaXNJRSA9IHdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZDtcclxuICAvLyBpZSA2LTEwXHJcbiAgdmFyIGlzT2xkSUUgPSAhIXdpbmRvdy5BY3RpdmVYT2JqZWN0O1xyXG5cclxuICBpZiAoKGlzQ2hyb21pdW0pIHx8IChpc0ZGKSB8fCAoaXNPcGVyYSkpIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICBpZiAoaXNTYWZhcmkgfHwgaXNJRSB8fCBpc09sZElFKSB7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIHJldHVybiBmYWxzZTtcclxufVxyXG5cclxuLy8gbmlnaHRpbmdhbGVQbGF5ZXIgY29uc3RydWN0b3JcclxudmFyIG5pZ2h0aW5nYWxlUGxheWVyID0gKGZ1bmN0aW9uKCkge1xyXG4gIC8vIFBsYXllciB2YXJzXHJcbiAgdmFyICRkID0gJChkb2N1bWVudCksXHJcbiAgICAgIHVwZGF0ZVRpbWVyLFxyXG4gICAgICB0b3RhbER1cmF0aW9uLFxyXG4gICAgICBwbGF5ZXJWb2x1bWVMZXZlbCxcclxuICAgICAgeXRwLFxyXG4gICAgICBzLFxyXG4gICAgICAvLyBQbGF5ZXIgc2V0dGluZ3NcclxuICAgICAgc2V0dGluZ3MgPSB7XHJcbiAgICAgICAgLy8gRGVmaW5lIHBsYXllciBlbGVtZW50c1xyXG4gICAgICAgICRwbGF5ZXJPdmVybGF5czogJCgnLnBsYXllci1vdmVybGF5JyksXHJcbiAgICAgICAgJGVuZEZyYW1lV3JhcHBlcjogJCgnI2VuZGZyYW1lLW92ZXJsYXktd3JhcHBlcicpLFxyXG4gICAgICAgICRwbGF5ZXJFbmRmcmFtZTogJCgnI2VuZGZyYW1lLW92ZXJsYXknKSxcclxuICAgICAgICAkYWxsQ29udHJvbHNXcmFwcGVyOiAkKCcuY29udHJvbHMnKSxcclxuICAgICAgICAkc3RhbmRhcmRQbGF5ZXJDb250cm9sczogJCgnLmNvbnRyb2xzX19zdGFuZGFyZCcpLFxyXG4gICAgICAgICRjb250cm9sc0NvbnRhaW5lcjogJCgnI2NvbnRyb2xzX19leHBhbmRpbmdfY2VudHJlJyksXHJcbiAgICAgICAgJHBsYXlQYXVzZUJ0bjogJCgnI2NvbnRyb2xzX19zdGFuZGFyZC0tcGxheS1wYXVzZScpLFxyXG4gICAgICAgICRtdXRlVG9nZ2xlQnRuOiAkKCcjY29udHJvbHNfX3N0YW5kYXJkLS10b2dnbGUtbXV0ZScpLFxyXG4gICAgICAgICRmc1RvZ2dsZUJ0bjogJCgnI2NvbnRyb2xzX19zdGFuZGFyZC0tZnMnKSxcclxuICAgICAgICAkZmFjZWJvb2tTaGFyZUJ0bjogJCgnLmZhY2Vib29rLXNoYXJlJyksXHJcbiAgICAgICAgJHR3aXR0ZXJTaGFyZUJ0bjogJCgnLnR3aXR0ZXItc2hhcmUnKSxcclxuICAgICAgICAkcGxheWVyU2Vla1NsaWRlcjogJCgnLnNlZWtzbGlkZXInKSxcclxuICAgICAgICAkcGxheWVkQmFyOiAkKCcuc2Vla3NsaWRlcl9fcGxheWVkJyksXHJcbiAgICAgICAgdGh1bWJEcmFnZ2luZzogZmFsc2UsXHJcbiAgICAgICAgJHZvbENvbnRhaW5lcjogJCgnLnZvbHVtZScpLFxyXG4gICAgICAgIC8vIERlZmluZSBwbGF5ZXIgY29sb3VyIHRoZW1lO1xyXG4gICAgICAgIGNvbG9yVGhlbWU6e1xyXG4gICAgICAgICAgcHJpbWFyeTogJyNmZmZmZmYnLFxyXG4gICAgICAgICAgc2Vjb25kYXJ5OiAnI2Y0NGMwMidcclxuICAgICAgICB9LFxyXG4gICAgICAgIC8vIE92ZXJyaWRhYmxlIGRlZmF1bHQgc2V0dGluZ3NcclxuICAgICAgICBkZWZhdWx0czoge1xyXG4gICAgICAgICAgdmlkZW9LZXk6ICdNbmYxNUt3UFYtUSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIC8vIFlvdVR1YmUgQXBpIHBhcmFtc1xyXG4gICAgICAgIHBsYXllckVsZW06ICduaWdodGluZ2FsZVBsYXllcicsXHJcbiAgICAgICAgcGxheWVyV2lkdGg6ICcxMDAlJyxcclxuICAgICAgICBwbGF5ZXJIZWlnaHQ6ICcxMDAlJyxcclxuICAgICAgICBhdXRvUGxheTogMSxcclxuICAgICAgICBlbmFibGVZb3VUdWJlQXBpOiAxLFxyXG4gICAgICAgIGVuYWJsZUNvbnRyb2xzOiAwLFxyXG4gICAgICAgIHNob3dQbGF5ZXJJbmZvOiAwLFxyXG4gICAgICAgIHNob3dSZWxhdGVkQ29udGVudDogMCxcclxuICAgICAgICBlbmFibGVNb2Rlc3RCcmFuZGluZzogMSxcclxuXHJcbiAgICAgICAgaW5pdFNldHRpbmdzQ2hpbGRyZW46IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgLy8gU2V0dGluZ3MgdGhhdCBuZWVkIHNpYmxpbmcgcmVmZXJlbmNlXHJcbiAgICAgICAgICB0aGlzLiRwbGF5ZXJFbGVtID0gICQoJyMnK3RoaXMucGxheWVyRWxlbSk7XHJcbiAgICAgICAgICB0aGlzLiRyZXBsYXlWaWRlb0J0biA9IHRoaXMuJHBsYXllckVuZGZyYW1lLmZpbmQoJ2J1dHRvbicpO1xyXG4gICAgICAgICAgdGhpcy4kY29udHJvbHNMaXN0ID0gdGhpcy4kY29udHJvbHNDb250YWluZXIuZmluZCgndWwnKTtcclxuICAgICAgICAgIHRoaXMuJHZvbFRyYWNrID0gdGhpcy4kdm9sQ29udGFpbmVyLmZpbmQoJy52b2x1bWVfX3RyYWNrJyk7XHJcbiAgICAgICAgICB0aGlzLiR2b2xTbGlkZXIgPSB0aGlzLiR2b2xDb250YWluZXIuZmluZCgnLnZvbHVtZV9fdHJhY2tfX3NsaWRlcicpO1xyXG4gICAgICAgICAgdGhpcy4kdm9sU2xpZGVyVGh1bWIgPSB0aGlzLiR2b2xDb250YWluZXIuZmluZCgnLnZvbHVtZV9fdHJhY2tfX3RodW1iJyk7XHJcblxyXG4gICAgICAgICAgZGVsZXRlIHRoaXMuaW5pdFNldHRpbmdzQ2hpbGRyZW47XHJcbiAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGluaXQob3B0aW9ucyl7XHJcblxyXG4gICAgICBzID0gc2V0dGluZ3M7XHJcbiAgICAgIHMuaW5pdFNldHRpbmdzQ2hpbGRyZW4oKTtcclxuXHJcbiAgICAgIC8vIElmIHNldCwgYXBwbHkgb3ZlcnJpZGUgb3B0aW9ucyB0byBzZXR0aW5nc1xyXG4gICAgICBpZihvcHRpb25zKXtcclxuICAgICAgICBmb3IodmFyIHByb3AgaW4gb3B0aW9ucyl7XHJcbiAgICAgICAgICBpZihvcHRpb25zLmhhc093blByb3BlcnR5KHByb3ApKXtcclxuICAgICAgICAgICAgICBzLmRlZmF1bHRzW3Byb3BdID0gb3B0aW9uc1twcm9wXTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENoZWNrIGZvciB0YXJnZXQgZGl2XHJcbiAgICAgIGlmKHMuJHBsYXllckVsZW0ubGVuZ3RoKXtcclxuXHJcbiAgICAgICAgLy8gTmV3IHVwIFlvdVR1YmUgcGxheWVyIHdpdGggcGxheWVyIHNldHRpbmdzXHJcbiAgICAgICAgeXRwID0gbmV3IFlULlBsYXllcihzLnBsYXllckVsZW0sIHtcclxuICAgICAgICAgICAgd2lkdGg6IHMucGxheWVyV2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDogcy5wbGF5ZXJIZWlnaHQsXHJcbiAgICAgICAgICAgIC8vIHZpZGVvSWQ6IChicm93c2VyQ2FuTG9hZFZpZGVvKCkpID8gcy5kZWZhdWx0cy52aWRlb0tleSA6IHMuZGVmYXVsdHMuZGlzYWJsZWRCcm93c2Vyc0tleSxcclxuICAgICAgICAgICAgdmlkZW9JZDogcy5kZWZhdWx0cy52aWRlb0tleSxcclxuICAgICAgICAgICAgcGxheWVyVmFyczoge1xyXG4gICAgICAgICAgICBhdXRvcGxheTogcy5hdXRvUGxheSxcclxuICAgICAgICAgICAgZW5hYmxlanNhcGk6IHMuZW5hYmxlWW91VHViZUFwaSxcclxuICAgICAgICAgICAgY29udHJvbHM6IHMuZW5hYmxlQ29udHJvbHMsXHJcbiAgICAgICAgICAgIHJlbDogcy5zaG93UmVsYXRlZENvbnRlbnQsXHJcbiAgICAgICAgICAgIHNob3dpbmZvOiBzLnNob3dQbGF5ZXJJbmZvLFxyXG4gICAgICAgICAgICBtb2Rlc3RicmFuZGluZzogcy5lbmFibGVNb2Rlc3RCcmFuZGluZ1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGV2ZW50czoge1xyXG4gICAgICAgICAgICAnb25SZWFkeSc6IG9uUGxheWVyUmVhZHksXHJcbiAgICAgICAgICAgICdvblN0YXRlQ2hhbmdlJzogb25QbGF5ZXJTdGF0ZUNoYW5nZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBGYWRlIHVwIHRoZSBwbGF5ZXIgb3ZlcmxheXNcclxuICAgICAgICBzLiRwbGF5ZXJPdmVybGF5cy5mYWRlSW4oKTtcclxuXHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIC8vIFRocm93IGFuIGVycm9yIGlmIG5vIHRhcmdldCBkaXYgZm91bmQuXHJcbiAgICAgICAgY29uc29sZS5lcnJvcignbmlnaHRpbmdhbGVQbGF5ZXIgRXJyb3I6IENhbm5vdCBpbml0aWFsaXNlLCBubyB0YXJnZXQgZGl2IGZvdW5kLiBQbGVhc2UgYWRkIGEgZGl2IHdpdGggaWQgXCJuaWdodGluZ2FsZVBsYXllclwiIHRvIHRoZSBwYWdlLicpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQmluZCBjdXN0b20gcGxheWVyIGV2ZW50c1xyXG4gICAgZnVuY3Rpb24gYmluZEN1c3RvbUV2ZW50cygpe1xyXG4gICAgICAvLyBET0NVTUVOVCBvbiBGVUxMU0NSRUVOXHJcbiAgICAgICRkLm9uKCd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlIG1vemZ1bGxzY3JlZW5jaGFuZ2UgZnVsbHNjcmVlbmNoYW5nZSBNU0Z1bGxzY3JlZW5DaGFuZ2UnLCBvbkZ1bGxzY3JlZW5DaGFuZ2UpO1xyXG4gICAgICAvLyBTRUVLIHNsaWRlciBvbiBNT1VTRSBET1dOIC8gVVAgLyBDSEFOR0VcclxuICAgICAgcy4kcGxheWVyU2Vla1NsaWRlci5vbignbW91c2Vkb3duJywgb25TZWVrTW91c2VEb3duKVxyXG4gICAgICAub24oJ21vdXNldXAnLCBvblNlZWtNb3VzZVVwKVxyXG4gICAgICAub24oJ21vdXNlbW92ZScsIG9uU2Vla01vdXNlTW92ZSk7XHJcbiAgICAgIC8vIFNUQU5EQVJEIHBsYXllciBjb250cm9sIG9uIENMSUNLXHJcbiAgICAgIHMuJHN0YW5kYXJkUGxheWVyQ29udHJvbHMub24oJ2NsaWNrJywgb25TdGFuZGFyZFBsYXllckNvbnRyb2xzQ2xpY2spO1xyXG4gICAgICAvLyBSRVBMQVkgdmlkZW8gYnV0dG9uIG9uIENMSUNLXHJcbiAgICAgIHMuJHJlcGxheVZpZGVvQnRuLm9uKCdjbGljaycsIG9uUmVwbGF5QnRuQ2xpY2spO1xyXG4gICAgICAvLyBWT0xVTUUgY29udGFpbmVyIG9uIENMSUNLXHJcbiAgICAgIHMuJHZvbENvbnRhaW5lci5vbignY2xpY2snLCBvblZvbHVtZUNvbnRhaW5lckludGVyYWN0KTtcclxuICAgICAgLy8gVk9MVU1FIHNsaWRlciBvbiBJTlBVVCBDSEFOR0VcclxuICAgICAgcy4kdm9sVHJhY2sub24oJ21vdXNlZG93bicsIG9uVm9sdW1lU2xpZGVyTW91c2VEb3duKVxyXG4gICAgICAub24oJ21vdXNlbW92ZScsIG9uVm9sdW1lU2xpZGVyTW91c2VNb3ZlKVxyXG4gICAgICAub24oJ21vdXNldXAnLCBvblZvbHVtZVNsaWRlck1vdXNlVXApO1xyXG4gICAgICAvLyBNVVRFIGJ1dHRvbiBvbiBNT1VTRU9WRVJcclxuICAgICAgcy4kbXV0ZVRvZ2dsZUJ0bi5vbignbW91c2VvdmVyJywgb25NdXRlVG9nZ2xlSG92ZXIpO1xyXG4gICAgICAvLyBNVVRFIGJ1dHRvbiBvbiBNT1VTRUxFQVZFXHJcbiAgICAgIHMuJGFsbENvbnRyb2xzV3JhcHBlci5vbignbW91c2VsZWF2ZScsIG9uQ29udHJvbHNCbHVyKTtcclxuICAgICAgLy8gRkFDRUJPT0sgc2hhcmUgYnV0dG9uIG9uIENMSUNLXHJcbiAgICAgIHMuJGZhY2Vib29rU2hhcmVCdG4ub24oJ2NsaWNrJywgb25GYWNlYm9va1NoYXJlQ2xpY2spO1xyXG4gICAgICAvLyBUV0lUVEVSIHNoYXJlIGJ1dHRvbiBvbiBDTElDS1xyXG4gICAgICBzLiR0d2l0dGVyU2hhcmVCdG4ub24oJ2NsaWNrJywgb25Ud2l0dGVyU2hhcmVDbGljayk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICogWW91dHViZSBFdmVudCBIYW5kbGVyc1xyXG4gICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxuICAgIC8vIFlvdVR1YmUgcGxheWVyIHJlYWR5XHJcbiAgICBmdW5jdGlvbiBvblBsYXllclJlYWR5KGV2ZW50KXtcclxuXHJcbiAgICAgIC8vIFNldCBjdXJyZW50IHZpZGVvIGR1cmF0aW9uXHJcbiAgICAgIHRvdGFsRHVyYXRpb24gPSB5dHAuZ2V0RHVyYXRpb24oKTtcclxuICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IHZvbHVtZVxyXG4gICAgICB2YXIgX2N1cnJlbnRWb2x1bWUgPSB5dHAuZ2V0Vm9sdW1lKCk7XHJcbiAgICAgIC8vIFNldCB1cCB2b2x1bWUgc2xpZGVyXHJcbiAgICAgIHMuJHZvbFNsaWRlci5jc3MoJ3dpZHRoJywgX2N1cnJlbnRWb2x1bWUrJyUnKTtcclxuICAgICAgLy8gVXBkYXRlIHRoZSBjdXJyZW50IHZvbHVtZSBsZXZlbCBpbiB0aGUgdm9sdW1lIHNsaWRlclxyXG4gICAgICBwbGF5ZXJWb2x1bWVMZXZlbCA9IHMuJHZvbFNsaWRlci5jc3MoJ3dpZHRoJyk7XHJcbiAgICAgIC8vIFNldCBZb3VUdWJlIHBsYXllciB0byBkZWZhdWx0IHF1YWxpdHkgc3RhdGUgZm9yIGFwcHJvcHJpYXRlIHBsYXliYWNrIHF1YWxpdHlcclxuICAgICAgZXZlbnQudGFyZ2V0LnNldFBsYXliYWNrUXVhbGl0eSgnZGVmYXVsdCcpO1xyXG4gICAgICAvLyBCaW5kIGN1c3RvbSBldmVudHNcclxuICAgICAgYmluZEN1c3RvbUV2ZW50cygpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIG9uUGxheWVyU3RhdGVDaGFuZ2UgKGV2ZW50KXtcclxuXHJcbiAgICAgIHZhciBfYWN0aXZlQ2xhc3MgPSAnYWN0aXZlJztcclxuXHJcbiAgICAgIC8vIFlvdVR1YmUgUGxheWVyIFN0YXRlc1xyXG4gICAgICBpZiAoZXZlbnQuZGF0YSA9PSBZVC5QbGF5ZXJTdGF0ZS5QTEFZSU5HKSB7XHJcblxyXG4gICAgICAgIG9uUGxheWVyU3RhdGVQbGF5aW5nKCk7XHJcbiAgICAgICAgLy8gVG9nZ2xlIHBsYXkgLyBwYXVzZVxyXG4gICAgICAgIHMuJHBsYXlQYXVzZUJ0bi5hZGRDbGFzcyhfYWN0aXZlQ2xhc3MpO1xyXG5cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBTdG9wcyB0aGUgc2VlayBiYXIgaWYgbm90IHBsYXlpbmdcclxuICAgICAgICBjbGVhclRpbWVvdXQodXBkYXRlVGltZXIpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmKGV2ZW50LmRhdGEgPT0gWVQuUGxheWVyU3RhdGUuUEFVU0VEKXtcclxuICAgICAgICAvLyBUb2dnbGUgcGxheSAvIHBhdXNlXHJcbiAgICAgICAgcy4kcGxheVBhdXNlQnRuLnJlbW92ZUNsYXNzKF9hY3RpdmVDbGFzcyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYoZXZlbnQuZGF0YSA9PSBZVC5QbGF5ZXJTdGF0ZS5FTkRFRCl7XHJcbiAgICAgICAgb25QbGF5ZXJTdGF0ZUVuZGVkKCk7XHJcbiAgICAgICAgLy8gVG9nZ2xlIHBsYXkgLyBwYXVzZVxyXG4gICAgICAgIHMuJHBsYXlQYXVzZUJ0bi5yZW1vdmVDbGFzcyhfYWN0aXZlQ2xhc3MpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICogbmlnaHRpbmdhbGVQbGF5ZXIgRXZlbnQgSGFuZGxlcnNcclxuICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuXHJcbiAgICAvLyBPbiBGVUxMU0NSRUVOIGNoYW5nZVxyXG4gICAgZnVuY3Rpb24gb25GdWxsc2NyZWVuQ2hhbmdlKCl7XHJcbiAgICAgIHMuJGZzVG9nZ2xlQnRuLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPbiBTVEFOREFSRCBwbGF5ZXIgY29udHJvbCBDTElDS1xyXG4gICAgZnVuY3Rpb24gb25TdGFuZGFyZFBsYXllckNvbnRyb2xzQ2xpY2soKXtcclxuXHJcbiAgICAgIHZhciBfaWQgPSAkKHRoaXMpLmF0dHIoJ2lkJyk7XHJcblxyXG4gICAgICBzd2l0Y2goX2lkKXtcclxuXHJcbiAgICAgICAgY2FzZSAnY29udHJvbHNfX3N0YW5kYXJkLS1wbGF5LXBhdXNlJzpcclxuICAgICAgICAgIGlmICh5dHAuZ2V0UGxheWVyU3RhdGUoKSA9PSBZVC5QbGF5ZXJTdGF0ZS5QTEFZSU5HKSB7XHJcbiAgICAgICAgICAgICAgeXRwLnBhdXNlVmlkZW8oKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgeXRwLnBsYXlWaWRlbygpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlICdjb250cm9sc19fc3RhbmRhcmQtLXRvZ2dsZS1tdXRlJzpcclxuICAgICAgICAgIGlmICgheXRwLmlzTXV0ZWQoKSkge1xyXG4gICAgICAgICAgICAgIHl0cC5tdXRlKCk7XHJcbiAgICAgICAgICAgICAgcy4kdm9sU2xpZGVyLmNzcygnd2lkdGgnLCAnMCUnKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgeXRwLnVuTXV0ZSgpO1xyXG4gICAgICAgICAgICAgIHMuJHZvbFNsaWRlci5jc3MoJ3dpZHRoJywgcGxheWVyVm9sdW1lTGV2ZWwpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ2NvbnRyb2xzX19zdGFuZGFyZC0tZnMnOlxyXG4gICAgICAgICAgcmVxdWVzdEZ1bGxTY3JlZW4oJCh0aGlzKS5oYXNDbGFzcygnYWN0aXZlJykpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT24gRkFDRUJPT0sgYnV0dG9uIENMSUNLXHJcbiAgICBmdW5jdGlvbiBvbkZhY2Vib29rU2hhcmVDbGljaygpe1xyXG4gICAgICAvLyBGYWNlYm9vayBzaGFyaW5nIGZ1bmN0aW9uYWxpdHlcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBvblR3aXR0ZXJTaGFyZUNsaWNrKCl7XHJcbiAgICAgIC8vIFR3aXR0ZXIgc2hhcmluZyBmdW5jdGlvbmFsaXR5XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT24gU0VFSyBzbGlkZXIgTU9VU0UgRE9XTlxyXG4gICAgZnVuY3Rpb24gb25TZWVrTW91c2VEb3duKGUpIHtcclxuICAgICAgLy8gcGF1c2UgdmlkZW8gYW5kIGxpc3RlbiBmb3IgaW5wdXQgZXZlbnRzICh2YWx1ZSBjaGFuZ2VzKSBmcm9tIGRyYWdnaW5nXHJcbiAgICAgIHl0cC5wYXVzZVZpZGVvKCk7XHJcbiAgICAgIHMudGh1bWJEcmFnZ2luZyA9IHRydWU7XHJcbiAgICAgIHVwZGF0ZVBsYXllZEJhcihlLnBhZ2VYKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPbiBTRUVLIHNsaWRlciBNT1VTRSBVUFxyXG4gICAgZnVuY3Rpb24gb25TZWVrTW91c2VVcChlKSB7XHJcbiAgICAgIGlmKHMudGh1bWJEcmFnZ2luZyl7XHJcbiAgICAgICAgcy50aHVtYkRyYWdnaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdXBkYXRlUGxheWVkQmFyKGUucGFnZVgpO1xyXG4gICAgICAgIHl0cC5wbGF5VmlkZW8oKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE9uIFNFRUsgbW91c2UgTU9WRVxyXG4gICAgZnVuY3Rpb24gb25TZWVrTW91c2VNb3ZlKGUpe1xyXG4gICAgICBpZihzLnRodW1iRHJhZ2dpbmcpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQodXBkYXRlVGltZXIpO1xyXG4gICAgICAgIHVwZGF0ZVBsYXllZEJhcihlLnBhZ2VYKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE9uIFJFUExBWSBidXR0b24gbW91c2UgQ0xJQ0tcclxuICAgIGZ1bmN0aW9uIG9uUmVwbGF5QnRuQ2xpY2soKXtcclxuICAgICAgcy4kcGxheWVyRW5kZnJhbWUuZmFkZU91dCh7ZHVyYXRpb24gOiA4MDAsIGNvbXBsZXRlOiBvbkVuZGZyYW1lRmFkZU91dENvbXBsZXRlfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT24gUE9TVEVSIGZhZGUgb3V0IENPTVBMRVRFXHJcbiAgICBmdW5jdGlvbiBvbkVuZGZyYW1lRmFkZU91dENvbXBsZXRlKCl7XHJcbiAgICAgIHl0cC5wbGF5VmlkZW8oKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPbiBWT0xVTUUgY29udGFpbmVyIENMSUNLXHJcbiAgICBmdW5jdGlvbiBvblZvbHVtZUNvbnRhaW5lckludGVyYWN0KGUpIHtcclxuICAgICAgLy8gUHJldmVudCBhY2NpZGVudGFsIGNsb3NlcyB3aGlsZSBkcmFnZ2luZyB2b2x1bWUgc2xpZGVyXHJcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9XHJcbiAgICAvLyBnZXQgdmFsdWUgb2Ygdm9sdW1lIHNsaWRlciBhbmQgdHJhbnNsYXRlIGludG8geXRwIHZvbHVtZVxyXG4gICAgZnVuY3Rpb24gb25Wb2x1bWVTbGlkZXJNb3VzZURvd24oZSkge1xyXG5cclxuICAgICAgcy50aHVtYkRyYWdnaW5nID0gdHJ1ZTtcclxuICAgICAgdXBkYXRlVm9sdW1lQmFyKGUucGFnZVgpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBvblZvbHVtZVNsaWRlck1vdXNlTW92ZShlKXtcclxuICAgICAgaWYocy50aHVtYkRyYWdnaW5nKSB7XHJcbiAgICAgICAgdXBkYXRlVm9sdW1lQmFyKGUucGFnZVgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gb25Wb2x1bWVTbGlkZXJNb3VzZVVwKGUpe1xyXG4gICAgICBpZihzLnRodW1iRHJhZ2dpbmcpe1xyXG4gICAgICAgIHMudGh1bWJEcmFnZ2luZyA9IGZhbHNlO1xyXG4gICAgICAgIHVwZGF0ZVZvbHVtZUJhcihlLnBhZ2VYKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIG9uTXV0ZVRvZ2dsZUhvdmVyKCkge1xyXG4gICAgICBzLiR2b2xDb250YWluZXIuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICBzLiR2b2xDb250YWluZXIuc3RvcCgpLmFuaW1hdGUoe1xyXG4gICAgICAgIHdpZHRoOiAnMTIwcHgnXHJcbiAgICAgIH0sIDE1MCwgJ2Vhc2VJbk91dFF1YWQnKVxyXG4gICAgICAuY3NzKCdvdmVyZmxvdycsICd2aXNpYmxlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gb25Db250cm9sc0JsdXIoKSB7XHJcbiAgICAgIHMuJHZvbENvbnRhaW5lci5zdG9wKCkuYW5pbWF0ZSh7XHJcbiAgICAgICAgd2lkdGg6ICcwJ1xyXG4gICAgICB9LCAyMDAsICdlYXNlSW5PdXRRdWFkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcy4kdm9sQ29udGFpbmVyLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgfSkuY3NzKCdvdmVyZmxvdycsICd2aXNpYmxlJyk7XHJcblxyXG4gICAgICBpZihzLnRodW1iRHJhZ2dpbmcpe1xyXG4gICAgICAgIHMudGh1bWJEcmFnZ2luZyA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICogcGxheWVyIFNUQVRFU1xyXG4gICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxuICAgIGZ1bmN0aW9uIG9uUGxheWVyU3RhdGVQbGF5aW5nKCl7XHJcblxyXG4gICAgICAvLyBTZXQgdXAgaW50ZXJ2YWwgdGltZXIgdG8gbW92ZSBzaWxkZXIgdGh1bWIgYWxvbmcgdGhlIHRyYWNrXHJcbiAgICAgIHVwZGF0ZVRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIHZhciBjdXJyZW50VGltZSA9IHl0cC5nZXRDdXJyZW50VGltZSgpLFxyXG4gICAgICAgICAgICBwZXJjZW50YWdlID0gMTAwICogY3VycmVudFRpbWUgLyB0b3RhbER1cmF0aW9uO1xyXG5cclxuICAgICAgICBzLiRwbGF5ZWRCYXIuY3NzKCd3aWR0aCcsIHBlcmNlbnRhZ2UrJyUnKTtcclxuXHJcbiAgICAgIH0sIDQwMCk7XHJcblxyXG4gICAgICAvLyBIaWRlIHRoZSBlbmRmcmFtZSBpZiBpdCBpcyB2aXNpYmxlIGFuZCB0aGUgdmlkZW8gc3RhcnRzIHBsYXlpbmdcclxuICAgICAgaWYgKHMuJGVuZEZyYW1lV3JhcHBlci5pcygnOnZpc2libGUnKSkge1xyXG4gICAgICAgIHMuJGVuZEZyYW1lV3JhcHBlci5oaWRlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBvblBsYXllclN0YXRlRW5kZWQoKXtcclxuICAgICAgLy8gc2hvdyB0aGUgZW5kIGZyYW1lLCBoaWRlIHBsYXllciBiZWhpbmQgaXQuXHJcbiAgICAgIHMuJGVuZEZyYW1lV3JhcHBlci5zaG93KCk7XHJcbiAgICAgIHMuJHBsYXllckVuZGZyYW1lLmZhZGVJbigxMDAwKTtcclxuXHJcbiAgICAgIC8vIFNldCBwbGF5ZWQgYmFyIHRvIGVuZCBwb3NpdGlvblxyXG4gICAgICBzLiRwbGF5ZWRCYXIuY3NzKCd3aWR0aCcsICcxMDAlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICogbmlnaHRpbmdhbGVQbGF5ZXIgRnVuY3Rpb25zXHJcbiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcblxyXG4gICAgLy8gVXBkYXRlIHBsYXllZCBiYXIgd2lkdGggYW5kIHNlZWsgdG8gb24gbW91c2UgbW92ZVxyXG4gICAgZnVuY3Rpb24gdXBkYXRlUGxheWVkQmFyKHBhZ2VYKSB7XHJcblxyXG4gICAgICAvLyBDYWx1bGF0ZSBuZXcgc2xpZGVyIHBlcmNlbnRhZ2UgYW5kIHZvbHVtZSBsZXZlbFxyXG4gICAgICB2YXIgX3BlcmNlbnRhZ2UgPSBjYWxjdWxhdGVTbGlkZXJQZXJjZW50YWdlKHBhZ2VYLCBzLiRwbGF5ZXJTZWVrU2xpZGVyKSxcclxuICAgICAgX3NlZWtWYWx1ZSA9IHRvdGFsRHVyYXRpb24gKiBfcGVyY2VudGFnZSAvIDEwMDtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBwbGF5ZWQgYmFyXHJcbiAgICAgIHMuJHBsYXllZEJhci5jc3MoJ3dpZHRoJywgX3BlcmNlbnRhZ2UrJyUnKTtcclxuXHJcbiAgICAgIC8vIFNlZWsgdG8gbmV3IGN1cnJlbnQgcG9zaXRpb25cclxuICAgICAgeXRwLnNlZWtUbyhfc2Vla1ZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgdm9sdW1lIGJhciBvbiBtb3VzZSBtb3ZlXHJcbiAgICBmdW5jdGlvbiB1cGRhdGVWb2x1bWVCYXIocGFnZVgpe1xyXG5cclxuICAgICAgLy8gQ2FsdWxhdGUgbmV3IHNsaWRlciBwZXJjZW50YWdlIGFuZCB2b2x1bWUgbGV2ZWxcclxuICAgICAgdmFyIF9wZXJjZW50YWdlID0gY2FsY3VsYXRlU2xpZGVyUGVyY2VudGFnZShwYWdlWCwgcy4kdm9sVHJhY2spLFxyXG4gICAgICAgICAgX3ZvbHVtZVZhbHVlID0gTWF0aC5yb3VuZChfcGVyY2VudGFnZSk7XHJcblxyXG4gICAgICBpZiAoX3ZvbHVtZVZhbHVlICE9PSAwKSB7XHJcbiAgICAgICAgeXRwLnVuTXV0ZSgpO1xyXG4gICAgICAgIHl0cC5zZXRWb2x1bWUoX3ZvbHVtZVZhbHVlKTtcclxuICAgICAgICBzLiRtdXRlVG9nZ2xlQnRuLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgfSBlbHNlIGlmIChfdm9sdW1lVmFsdWUgPT09IDApIHtcclxuICAgICAgICB5dHAubXV0ZSgpO1xyXG4gICAgICAgIHMuJG11dGVUb2dnbGVCdG4ucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBwbGF5ZXJWb2x1bWVMZXZlbCA9IHl0cC5nZXRWb2x1bWUoKSsnJSc7XHJcbiAgICAgIHMuJHZvbFNsaWRlci5jc3MoJ3dpZHRoJywgX3BlcmNlbnRhZ2UrJyUnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDYWx1bGF0ZSBzbGlkZXIgcGVyY2VudGFnZVxyXG4gICAgZnVuY3Rpb24gY2FsY3VsYXRlU2xpZGVyUGVyY2VudGFnZShwYWdlWCwgc2xpZGVyVHJhY2spe1xyXG5cclxuICAgICAgLy8gR2V0IHRoZSBjbGljayBwb3NpdGlvblxyXG4gICAgICB2YXIgX3Bvc2l0aW9uID0gcGFnZVggLSBzbGlkZXJUcmFjay5vZmZzZXQoKS5sZWZ0LFxyXG4gICAgICAgICAgLy8gQ2FsdWxhdGUgdGhlIHBlcmNlbnRhZ2VcclxuICAgICAgICAgIF9wZXJjZW50YWdlID0gMTAwICogX3Bvc2l0aW9uIC8gc2xpZGVyVHJhY2sud2lkdGgoKTtcclxuXHJcbiAgICAgIC8vIENoZWNrIHdpdGhpbiByYW5nZVxyXG4gICAgICBpZihfcGVyY2VudGFnZSA+IDEwMCkge1xyXG4gICAgICAgICAgX3BlcmNlbnRhZ2UgPSAxMDA7XHJcbiAgICAgIH1cclxuICAgICAgaWYoX3BlcmNlbnRhZ2UgPCAwKSB7XHJcbiAgICAgICAgICBfcGVyY2VudGFnZSA9IDA7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBfcGVyY2VudGFnZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGdWxsc2NyZWVuIGhhbmRsZXJcclxuICAgIGZ1bmN0aW9uIHJlcXVlc3RGdWxsU2NyZWVuKGlzRnVsbHNjcmVlbil7XHJcblxyXG4gICAgICB2YXIgX3JlcXVlc3RNZXRob2QsXHJcbiAgICAgICAgICBfZWxlbWVudDtcclxuXHJcbiAgICAgIGlmKCFpc0Z1bGxzY3JlZW4pe1xyXG4gICAgICAgIF9lbGVtZW50ID0gZG9jdW1lbnQuYm9keTtcclxuICAgICAgICBfcmVxdWVzdE1ldGhvZCA9IF9lbGVtZW50LnJlcXVlc3RGdWxsU2NyZWVuIHx8IF9lbGVtZW50LndlYmtpdFJlcXVlc3RGdWxsU2NyZWVuIHx8IF9lbGVtZW50Lm1velJlcXVlc3RGdWxsU2NyZWVuIHx8IF9lbGVtZW50Lm1zUmVxdWVzdEZ1bGxzY3JlZW47XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgX2VsZW1lbnQgPSBkb2N1bWVudDtcclxuICAgICAgICBfcmVxdWVzdE1ldGhvZCA9IF9lbGVtZW50LmNhbmNlbEZ1bGxTY3JlZW4gfHwgX2VsZW1lbnQud2Via2l0Q2FuY2VsRnVsbFNjcmVlbiB8fCBfZWxlbWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuIHx8IF9lbGVtZW50Lm1zRXhpdEZ1bGxzY3JlZW47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChfcmVxdWVzdE1ldGhvZCkge1xyXG4gICAgICAgICAgX3JlcXVlc3RNZXRob2QuY2FsbChfZWxlbWVudCk7XHJcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdy5BY3RpdmVYT2JqZWN0ICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICB2YXIgd3NjcmlwdCA9IG5ldyBBY3RpdmVYT2JqZWN0KFwiV1NjcmlwdC5TaGVsbFwiKTtcclxuICAgICAgICAgIGlmICh3c2NyaXB0ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgd3NjcmlwdC5TZW5kS2V5cyhcIntGMTF9XCIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmV0dXJuIHB1YmxpY1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaW5pdDogaW5pdFxyXG4gICAgfTtcclxuXHJcbn0pKCQpO1xyXG4iXSwiZmlsZSI6Im5pZ2h0aW5nYWxlUGxheWVyLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=\n"],"sourceRoot":"/source/"}